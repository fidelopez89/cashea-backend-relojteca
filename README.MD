# ğŸ”„ Cashea â†”ï¸ Shopify Integration Backend

Backend serverless para sincronizar pagos de Cashea con Ã³rdenes de Shopify - Relojteca.

## ğŸ“‹ CaracterÃ­sticas

- âœ… ConfirmaciÃ³n automÃ¡tica de pagos en Cashea
- âœ… CreaciÃ³n de Ã³rdenes en Shopify
- âœ… ValidaciÃ³n de datos completos (productos, cliente, direcciÃ³n)
- âœ… ActualizaciÃ³n automÃ¡tica de inventario
- âœ… Manejo robusto de errores
- âœ… Logs detallados para debugging

## ğŸ—ï¸ Estructura del Proyecto

```
cashea-backend-relojteca/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ confirmar-cashea.js    # FunciÃ³n principal
â”œâ”€â”€ package.json               # Dependencias
â”œâ”€â”€ vercel.json               # ConfiguraciÃ³n de Vercel
â”œâ”€â”€ .env.example              # Ejemplo de variables de entorno
â””â”€â”€ README.md                 # Esta documentaciÃ³n
```

## ğŸš€ Deployment en Vercel

### Paso 1: Subir a GitHub

```bash
git add .
git commit -m "IntegraciÃ³n completa Cashea-Shopify"
git push origin main
```

### Paso 2: Deploy en Vercel

1. Ve a [vercel.com](https://vercel.com) e inicia sesiÃ³n
2. Click en **Add New** > **Project**
3. Importa tu repositorio: `fidelopez89/cashea-backend-relojteca`
4. En **Environment Variables**, agrega:
   ```
   CASHEA_API_KEY=5f7747b87bbf114a29343094fe49e901
   SHOPIFY_STORE=relojteca
   SHOPIFY_ACCESS_TOKEN=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
   NODE_ENV=production
   ```
5. Click en **Deploy**

### Paso 3: URL del Endpoint

Una vez desplegado, tu endpoint serÃ¡:
```
https://cashea-backend-relojteca.vercel.app/api/confirmar-cashea
```

## ğŸ§ª Testing

### Ejemplo de solicitud:

```bash
curl -X POST https://cashea-backend-relojteca.vercel.app/api/confirmar-cashea \
  -H "Content-Type: application/json" \
  -d '{
    "idNumber": "123456",
    "amount": 100.00,
    "customer": {
      "first_name": "Juan",
      "last_name": "PÃ©rez",
      "email": "juan@example.com",
      "phone": "+58412xxxxxxx",
      "address1": "Calle Principal 123",
      "city": "Caracas",
      "province": "Miranda",
      "country": "VE",
      "zip": "1010"
    },
    "lineItems": [
      {
        "title": "Reloj Casio G-Shock",
        "price": "100.00",
        "quantity": 1,
        "sku": "CASIO-GSHOCK-001"
      }
    ],
    "shippingAddress": {
      "first_name": "Juan",
      "last_name": "PÃ©rez",
      "address1": "Calle Principal 123",
      "city": "Caracas",
      "province": "Miranda",
      "country": "VE",
      "zip": "1010"
    }
  }'
```

### Respuesta esperada (Ã©xito):

```json
{
  "success": true,
  "idNumber": "123456",
  "amount": 100.00,
  "message": "Pago confirmado en Cashea y orden creada en Shopify",
  "shopifyOrder": {
    "id": 5678901234,
    "order_number": 1001,
    "total_price": "100.00"
  }
}
```

## ğŸ”§ Troubleshooting

### Error: "Error al confirmar con Cashea"
- Verifica que `CASHEA_API_KEY` estÃ© correcta en Vercel
- Confirma que el `idNumber` sea vÃ¡lido

### Error: "Error al crear orden en Shopify"
- Verifica `SHOPIFY_STORE` y `SHOPIFY_ACCESS_TOKEN` en Vercel
- Confirma que la Legacy Custom App tenga los permisos necesarios

### Error: "Datos incompletos"
- AsegÃºrate de enviar `idNumber`, `amount`, `customer` y `lineItems`

## ğŸ“Š Logs

Para ver logs en Vercel:
1. Ve a tu proyecto en Vercel
2. Click en **Deployments**
3. Click en tu deployment mÃ¡s reciente
4. Ve a **Functions** > `api/confirmar-cashea`

## ğŸ”’ Seguridad

- âœ… API keys almacenadas como variables de entorno
- âœ… CORS configurado
- âœ… ValidaciÃ³n de datos de entrada
- âœ… Manejo seguro de errores

## ğŸ“ Changelog

### v2.0.0 (Actual)
- âœ… IntegraciÃ³n completa con Shopify usando Legacy Custom App
- âœ… ValidaciÃ³n completa de datos
- âœ… ActualizaciÃ³n automÃ¡tica de inventario
- âœ… Logs detallados